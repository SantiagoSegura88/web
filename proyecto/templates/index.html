<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detector de Manos y Dedos</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

    <div class="container">

        <h1>Detector de Manos y Dedos</h1>
        <p class="description">
            Este sistema detecta mano derecha, izquierda, si están abiertas o cerradas,
            y cuántos dedos están extendidos. Selecciona la cámara para iniciar.
        </p>

        <!-- Selector de cámara -->
        <div class="camera-selector">
            <label>Seleccionar cámara:</label>
            <select id="cameraSelect">
                {% for cam in cameras %}
                    <option value="{{ cam.id }}">{{ cam.name }}</option>
                {% endfor %}
            </select>
            <button onclick="startCamera()">Iniciar</button>
        </div>

        <div class="content">
            <!-- Video -->
            <div class="video-box">
                <img id="videoStream" src="">
            </div>

            <!-- Información -->
            <div class="info-box">
                <h2>Estado de detección</h2>

                <table>
                    <tr><th>Mano</th><th>Estado</th><th>Dedos</th></tr>
                    <tr><td>Izquierda</td><td id="leftStatus">-</td><td id="leftFingers">-</td></tr>
                    <tr><td>Derecha</td><td id="rightStatus">-</td><td id="rightFingers">-</td></tr>
                </table>
            </div>
        </div>

    </div>

<script>
function startCamera() {
    const camId = document.getElementById("cameraSelect").value;

    fetch("/select_camera", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ camera_id: camId })
    }).then(() => {
        document.getElementById("videoStream").src = "/video_feed";
    });
}

setInterval(() => {
    fetch("/hand_status")
        .then(r => r.json())
        .then(data => {
            if (data.left) {
                document.getElementById("leftStatus").innerText = data.left.open ? "Abierta" : "Cerrada";
                document.getElementById("leftFingers").innerText = data.left.fingers;
            } else {
                document.getElementById("leftStatus").innerText = "-";
                document.getElementById("leftFingers").innerText = "-";
            }

            if (data.right) {
                document.getElementById("rightStatus").innerText = data.right.open ? "Abierta" : "Cerrada";
                document.getElementById("rightFingers").innerText = data.right.fingers;
            } else {
                document.getElementById("rightStatus").innerText = "-";
                document.getElementById("rightFingers").innerText = "-";
            }
        });
}, 300);
</script>

</body>
</html>
